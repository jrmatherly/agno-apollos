{
  "metrics": [
    {
      "name": "Active Sessions",
      "definition": "Agent sessions with at least one run in the last 24 hours",
      "table": "agno_agent_sessions",
      "calculation": "COUNT(*) from agno_agent_sessions WHERE updated_at > NOW() - INTERVAL '24 hours'"
    },
    {
      "name": "Agent Runs",
      "definition": "Total individual agent invocations within sessions",
      "table": "agno_agent_runs",
      "calculation": "COUNT(*) from agno_agent_runs"
    },
    {
      "name": "Approval Rate",
      "definition": "Percentage of approval requests that were approved",
      "table": "agno_approvals",
      "calculation": "COUNT(*) WHERE status='approved' / COUNT(*) total"
    }
  ],
  "business_rules": [
    "One session contains many runs — always join on session_id",
    "Timestamps are timezone-aware UTC across all tables",
    "session_id and run_id are UUIDs — never cast to integer",
    "Memory entries grow over time — use LIMIT when querying agno_memories",
    "Workflow session_state is JSON — use JSON operators for extraction"
  ],
  "common_gotchas": [
    {
      "issue": "UUID comparison",
      "tables_affected": [
        "agno_agent_sessions",
        "agno_agent_runs",
        "agno_memories"
      ],
      "solution": "IDs are UUID type — use string comparison or ::uuid cast, never integer cast"
    },
    {
      "issue": "JSON session_state access",
      "tables_affected": ["agno_workflow_sessions"],
      "solution": "Use session_state->>'key' for text or session_state->'key' for JSON extraction"
    },
    {
      "issue": "NULL resolved_at in approvals",
      "tables_affected": ["agno_approvals"],
      "solution": "resolved_at is NULL for pending approvals — filter with IS NOT NULL for completed"
    }
  ]
}
