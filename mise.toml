# =============================================================================
# Apollos AI — mise configuration
# =============================================================================
# Docs: https://mise.jdx.dev/configuration.html
# Tasks: mise tasks  |  Run: mise run <task>  |  Watch: mise watch -t <task>
# =============================================================================

# ---------------------------------------------------------------------------
# Tools
# ---------------------------------------------------------------------------
[tools]
python = "3.12"
uv = "latest"
node = "24"
pnpm = "latest"

# ---------------------------------------------------------------------------
# Environment
# ---------------------------------------------------------------------------
# Uses [[env]] array-of-tables so .env values override defaults below.
# Mise processes [[env]] blocks in order — defaults first, then .env wins.
# See: https://mise.jdx.dev/environments/#multiple-env-directives

[[env]]
PYTHONPATH = "{{config_root}}"

# Defaults for local development (overridden by .env when present)
LITELLM_BASE_URL = "http://localhost:4000/v1"
MODEL_ID = "gpt-5-mini"
EMBEDDING_MODEL_ID = "text-embedding-3-small"
EMBEDDING_DIMENSIONS = "1536"

DB_HOST = "apollos-db"
DB_PORT = "5432"
DB_USER = "ai"
DB_PASS = "ai"
DB_DATABASE = "ai"
DB_DRIVER = "postgresql+psycopg"

RUNTIME_ENV = "dev"
AGNO_DEBUG = "True"
AUTH_DEBUG = "True"

# Documents directory for knowledge agent file browsing
DOCUMENTS_DIR = "{{config_root}}/data/docs"

# Authentication — Legacy HS256 (retained for backward-compat tooling)
JWT_SECRET_KEY = ""

# Authentication — Azure Entra ID (set all 4 to enable; empty = Entra auth disabled)
AZURE_TENANT_ID = ""
AZURE_CLIENT_ID = ""
AZURE_CLIENT_SECRET = ""
AZURE_AUDIENCE = ""

# CORS: Frontend URL allowed by Access-Control-Allow-Origin (empty = all origins)
FRONTEND_URL = "http://localhost:3000"

# JWKS cache tuning (these are the defaults in AuthConfig — uncomment to override)
# JWKS_REFRESH_INTERVAL = "3600"
# JWKS_MISS_COOLDOWN = "300"
# GROUP_SYNC_INTERVAL = "900"

# Observability
# Set TRACING_ENABLED=true to store traces in PostgreSQL
TRACING_ENABLED = ""
# Comma-separated OTLP endpoints (e.g., Langfuse, SIEM, Arize Phoenix)
OTLP_ENDPOINTS = ""
# Comma-separated auth headers (parallel to OTLP_ENDPOINTS)
OTLP_AUTH_HEADERS = ""
# Legacy: still supported as single-endpoint fallback
OTEL_EXPORTER_OTLP_ENDPOINT = ""

# A2A Protocol (set A2A_ENABLED=true to expose agents via A2A endpoints)
A2A_ENABLED = ""
A2A_BASE_URL = "http://localhost:8000"

# Agent-as-judge quality evaluation (set to true to enable; adds LLM call per agent run)
AGENT_JUDGE_ENABLED = ""

[[env]]
_.file = ".env"

# ---------------------------------------------------------------------------
# Settings
# ---------------------------------------------------------------------------
[settings]
experimental = true

# ---------------------------------------------------------------------------
# Available Tasks (mise run <task>)
# ---------------------------------------------------------------------------
# setup [--ci]        Install all dependencies (--ci for locked/frozen mode)
# format [--check]    Format Python code (--check for CI check-only mode)
# lint                Lint Python code (ruff check)
# typecheck           Type-check Python code (mypy)
# validate            Run all checks (backend + frontend)
# dev                 Start full stack in watch mode (hot-reload)
# db                  Start database only (PostgreSQL + pgvector)
# load-docs           Load knowledge base documents into vector DB
# load-sample-data    Load F1 sample data into PostgreSQL for dev/demo/evals
# load-knowledge      Load knowledge files into vector DB (--recreate to rebuild)
# ci                  Full CI pipeline (install + validate)
# clean               Clean build artifacts and caches
# release             Create a GitHub release (interactive version prompt)
# test                Run integration tests (requires running backend)
# evals:run           Run agent eval suite (-c -v -g -s --direct)
# evals:reliability   Run tool-call reliability evals for all agents and teams
# maintenance:optimize-memories  Summarize and compress agent memories for all users
# auth:generate-token Generate a test JWT token for development
# schedules:setup     Create default scheduler schedules
# agent:cli           Run an agent via CLI (-- <module> [-q question])
# hooks:install       Install git pre-commit hook (auto-format + validate)
#
# docker:up [--prod] [--docs]           Start full stack (--prod for GHCR, --docs for docs service)
# docker:down [--prod]                  Stop all services (--prod targets production compose file)
# docker:logs [--prod]                  Tail logs from all services
# docker:build [--platform amd64|arm64] Build Docker images (default: native arch)
#
# frontend:dev          Start frontend dev server (Next.js, port 3000)
# frontend:build        Build frontend for production
# frontend:setup [--ci] Install frontend dependencies (--ci for frozen lockfile)
# frontend:lint         Lint frontend code (ESLint)
# frontend:format       Check frontend formatting (Prettier)
# frontend:typecheck    Type-check frontend code (TypeScript)
# frontend:validate     Run all frontend checks (lint + format + typecheck)
#
# docs:dev           Preview docs site locally (Mintlify, port 3333)
# docs:validate      Validate docs build and check for broken links
# docs:docker        Start docs site in Docker (--prod for GHCR image)
