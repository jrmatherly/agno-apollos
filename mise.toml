# =============================================================================
# Apollos AI — mise configuration
# =============================================================================
# Docs: https://mise.jdx.dev/configuration.html
# Tasks: mise tasks  |  Run: mise run <task>  |  Watch: mise watch -t <task>
# =============================================================================

# ---------------------------------------------------------------------------
# Tools
# ---------------------------------------------------------------------------
[tools]
python = "3.12"
uv = "latest"
node = "24"
pnpm = "latest"

# ---------------------------------------------------------------------------
# Environment
# ---------------------------------------------------------------------------
# Uses [[env]] array-of-tables so .env values override defaults below.
# Mise processes [[env]] blocks in order — defaults first, then .env wins.
# See: https://mise.jdx.dev/environments/#multiple-env-directives

[[env]]
PYTHONPATH = "{{config_root}}"

# Defaults for local development (overridden by .env when present)
LITELLM_BASE_URL = "http://localhost:4000/v1"
MODEL_ID = "gpt-5-mini"
EMBEDDING_MODEL_ID = "text-embedding-3-small"
EMBEDDING_DIMENSIONS = "1536"

DB_HOST = "apollos-db"
DB_PORT = "5432"
DB_USER = "ai"
DB_PASS = "ai"
DB_DATABASE = "ai"
DB_DRIVER = "postgresql+psycopg"

RUNTIME_ENV = "dev"
AGNO_DEBUG = "True"

[[env]]
_.file = ".env"

# ---------------------------------------------------------------------------
# Settings
# ---------------------------------------------------------------------------
[settings]
experimental = true

# ---------------------------------------------------------------------------
# Available Tasks (mise run <task>)
# ---------------------------------------------------------------------------
# setup [--ci]       Install all dependencies (--ci for locked/frozen mode)
# format [--check]   Format Python code (--check for CI check-only mode)
# lint               Lint Python code (ruff check)
# typecheck          Type-check Python code (mypy)
# validate           Run all checks (backend + frontend)
# dev                Start full stack in watch mode (hot-reload)
# db                 Start database only (PostgreSQL + pgvector)
# load-docs          Load knowledge base documents into vector DB
# ci                 Full CI pipeline (install + validate)
# clean              Clean build artifacts and caches
# release            Create a GitHub release (interactive version prompt)
#
# docker:up [--prod]  Start full stack (--prod pulls GHCR images instead of building)
# docker:down [--prod] Stop all services (--prod targets production compose file)
# docker:logs [--prod] Tail logs from all services
# docker:build [--platform amd64|arm64] Build Docker images (default: native arch)
#
# frontend:dev       Start frontend dev server (Next.js)
# frontend:build     Build frontend for production
# frontend:setup [--ci] Install frontend dependencies (--ci for frozen lockfile)
# frontend:lint      Lint frontend code (ESLint)
# frontend:format    Check frontend formatting (Prettier)
# frontend:typecheck Type-check frontend code (TypeScript)
# frontend:validate  Run all frontend checks (lint + format + typecheck)
#
# docs:dev           Preview docs site locally (Mintlify, port 3333)
# docs:validate      Validate docs build and check for broken links
