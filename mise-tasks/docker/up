#!/usr/bin/env bash
#MISE description="Start the full stack (build + detach)"
#USAGE flag "--prod" help="Use production compose file (pre-built GHCR images)"
#USAGE flag "--docs" help="Include the docs service"
#USAGE flag "--m365" help="Include the M365 MCP server"
set -e

PROFILE_FLAGS=""
if [ "${usage_docs:-false}" = "true" ]; then
  PROFILE_FLAGS="--profile docs"
fi
if [ "${usage_m365:-false}" = "true" ]; then
  PROFILE_FLAGS="${PROFILE_FLAGS} --profile m365"
fi

if [ "${usage_prod:-false}" = "true" ]; then
  docker compose -f docker-compose.prod.yaml ${PROFILE_FLAGS} up -d
  echo ""
  echo "Apollos AI (prod) running at http://localhost:8000"
else
  docker compose ${PROFILE_FLAGS} up -d --build
  echo ""
  echo "Apollos AI running at http://localhost:8000"
fi

if [ "${usage_docs:-false}" = "true" ]; then
  echo "Docs running at http://localhost:3333"
fi
if [ "${usage_m365:-false}" = "true" ]; then
  echo "M365 MCP server running at http://localhost:${M365_MCP_PORT:-9000}"
fi
